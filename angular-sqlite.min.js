!function(window,angular,undefined){"use strict";var HTML5SqliteCls=function($q,name,size,ver,desc,debug){var db,dbName=name,dbSize=size,dbVer=ver,dbDesc=desc,debugMode=debug,connect=function(){return(db===undefined||null===db)&&(db=openDatabase(dbName,dbVer,dbDesc,dbSize)),db},errorHandler=function(error,defer){defer.reject(error),debugMode===!0&&console.log("error:",error)},successHandler=function(results,defer){defer.resolve(results),debugMode===!0&&console.log("success:",results)},placeholder=function(i){for(var p=[],j=0;i>j;++j)p.push("?");return p.join(",")},query=function(sql,data){data=data||[];var defer=$q.defer();return db.transaction(function(tx){tx.executeSql(sql,data,function(tx,results){successHandler(results,defer)},function(tx,error){errorHandler(error,defer)})}),defer.promise},parse=function(results,type){switch(type&&(type=type.toUpperCase()),type){case"INSERT":return results.insertId;case"UPDATE":case"DELETE":return results.rowsAffected;default:var i,len=results.rows.length,data=[];for(i=0;len>i;++i)data.push(results.rows.item(i));return data}};this.createTable=function(name,params,overwrite){overwrite=overwrite||!0;var sql="CREATE TABLE ",fields=[];return overwrite&&(sql+=" IF NOT EXISTS "),sql+=name+" (",angular.forEach(params,function(value,key){fields.push(key+" "+value)}),sql+=fields.join(",")+")",query(sql)},this.getTransaction=function(rollback){var defer=$q.defer();return db.transaction(function(tx){defer.resolve(tx)},rollback),defer.promise},this.listTables=function(){var defer=$q.defer(),sql="SELECT * FROM sqlite_master WHERE type=?";return query(sql,["table"]).then(function(results){defer.resolve(parse(results))})["catch"](function(error){defer.reject(error)}),defer.promise},this.create=function(tableName,params){var defer=$q.defer(),sql="INSERT INTO "+tableName+"(",fields=[],data=[];return angular.forEach(params,function(value,field){fields.push(field),data.push(value)}),sql+=fields.join(",")+") VALUES ("+placeholder(data.length)+")",query(sql,data).then(function(results){defer.resolve(parse(results,"INSERT"))})["catch"](function(error){defer.resolve(error)}),defer.promise},this.find=function(tableName,params){var defer=$q.defer(),sql="SELECT ",data=[];return sql+=params.fields?params.fields.join(","):" * ",sql+=" FROM "+tableName,params.where&&(sql+=" WHERE "+params.where),params.order&&(sql+=" ORDER BY "+params.order),params.limit&&(sql+=" LIMIT "+params.limit),query(sql,data).then(function(result){defer.resolve(parse(result))})["catch"](function(error){defer.reject(error)}),defer.promise},this.save=function(tableName,params,where){var defer=$q.defer(),sql="UPDATE "+tableName+" SET ",fields=[],data=[];return angular.forEach(params,function(value,field){fields.push(field+"=?"),data.push(value)}),sql+=fields.join(","),where&&(sql+=" WHERE "+where),query(sql,data).then(function(result){defer.resolve(parse(result,"UPDATE"))})["catch"](function(error){defer.reject(error)}),defer.promise},this.del=function(tableName,where){var defer=$q.defer(),sql="DELETE FROM "+tableName;return where&&(sql+=" WHERE "+where),query(sql).then(function(result){defer.resolve(parse(result,"DELETE"))})["catch"](function(error){defer.reject(error)}),defer.promise},this.parse=parse,this.query=query,connect()},app=angular.module("nbSqlite",[]);app.provider("$sqlite",function(){var dbName="defaultDBName",dbSize=5242880,dbVer="1.0",dbDesc="Angular Sqlite Database",debug=!1;this.config=function(name,size,desc,debugMode){dbName=name||dbName,dbSize=size||dbSize,dbDesc=desc||dbDesc,debug=debugMode||debug},this.$get=["$q",function($q){return new HTML5SqliteCls($q,dbName,dbSize,dbVer,dbDesc,debug)}]})}(window,window.angular);